import{d as se,l as ne,e as U,o as y,w as K,r as v,s as ie,a as p,P as Z,B as le,D as ee,f as g,I as N,ao as te,O as q,H as ae,aw as b,ax as oe,J as H,L as d,K as B,q as C,j as ue,M as $,N as O,ay as re,az as de,aA as Q,h as G,Q as M,i as X,n as ce,aB as V,aC as fe,aD as pe,v as me,x as ye,aE as ve}from"#entry";import{e as he}from"./Dxt7HkM3.js";var be=se({__name:"Label",props:{for:{type:String,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"label"}},setup(t){const a=t;return ne(),(s,r)=>(y(),U(p(Z),ie(a,{onMousedown:r[0]||(r[0]=i=>{!i.defaultPrevented&&i.detail>1&&i.preventDefault()})}),{default:K(()=>[v(s.$slots,"default")]),_:3},16))}}),ge=be;const we={slots:{root:"",wrapper:"",labelWrapper:"flex content-center items-center justify-between",label:"block font-medium text-default",container:"mt-1 relative",description:"text-muted",error:"mt-2 text-error",hint:"text-muted",help:"mt-2 text-muted"},variants:{size:{xs:{root:"text-xs"},sm:{root:"text-xs"},md:{root:"text-sm"},lg:{root:"text-sm"},xl:{root:"text-base"}},required:{true:{label:"after:content-['*'] after:ms-0.5 after:text-error"}}},defaultVariants:{size:"md"}},qe=["id"],Se=["id"],xe=["id"],Ee=["id"],Ne={__name:"UFormField",props:{as:{type:null,required:!1},name:{type:String,required:!1},errorPattern:{type:null,required:!1},label:{type:String,required:!1},description:{type:String,required:!1},help:{type:String,required:!1},error:{type:[Boolean,String],required:!1},hint:{type:String,required:!1},size:{type:null,required:!1},required:{type:Boolean,required:!1},eagerValidation:{type:Boolean,required:!1},validateOnInputDelay:{type:Number,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(t){const a=t,s=le(),r=ee(),i=g(()=>N({extend:N(we),...r.ui?.formField||{}})({size:a.size,required:a.required})),w=te(re,null),m=g(()=>a.error||w?.value?.find(l=>l.name&&(l.name===a.name||a.errorPattern&&l.name.match(a.errorPattern)))?.message),c=q(ae()),f=c.value;return b(de,c),b(oe,g(()=>({error:m.value,name:a.name,size:a.size,eagerValidation:a.eagerValidation,validateOnInputDelay:a.validateOnInputDelay,errorPattern:a.errorPattern,hint:a.hint,description:a.description,help:a.help,ariaId:f}))),(l,k)=>(y(),U(p(Z),{as:t.as,class:d(i.value.root({class:[a.ui?.root,a.class]}))},{default:K(()=>[H("div",{class:d(i.value.wrapper({class:a.ui?.wrapper}))},[t.label||s.label?(y(),B("div",{key:0,class:d(i.value.labelWrapper({class:a.ui?.labelWrapper}))},[ue(p(ge),{for:c.value,class:d(i.value.label({class:a.ui?.label}))},{default:K(()=>[v(l.$slots,"label",{label:t.label},()=>[$(O(t.label),1)])]),_:3},8,["for","class"]),t.hint||s.hint?(y(),B("span",{key:0,id:`${p(f)}-hint`,class:d(i.value.hint({class:a.ui?.hint}))},[v(l.$slots,"hint",{hint:t.hint},()=>[$(O(t.hint),1)])],10,qe)):C("",!0)],2)):C("",!0),t.description||s.description?(y(),B("p",{key:1,id:`${p(f)}-description`,class:d(i.value.description({class:a.ui?.description}))},[v(l.$slots,"description",{description:t.description},()=>[$(O(t.description),1)])],10,Se)):C("",!0)],2),H("div",{class:d([(t.label||!!s.label||t.description||!!s.description)&&i.value.container({class:a.ui?.container})])},[v(l.$slots,"default",{error:m.value}),typeof m.value=="string"&&m.value||s.error?(y(),B("div",{key:0,id:`${p(f)}-error`,class:d(i.value.error({class:a.ui?.error}))},[v(l.$slots,"error",{error:m.value},()=>[$(O(m.value),1)])],10,xe)):t.help||s.help?(y(),B("div",{key:1,id:`${p(f)}-help`,class:d(i.value.help({class:a.ui?.help}))},[v(l.$slots,"help",{help:t.help},()=>[$(O(t.help),1)])],10,Ee)):C("",!0)],2)]),_:3},8,["as","class"]))}};function Ie(t){return t.validate&&t.__isYupSchema__}function je(t){return t.inner!==void 0}function Fe(t){return"schema"in t&&typeof t.coercer=="function"&&typeof t.validator=="function"&&typeof t.refiner=="function"}function Be(t){return t.validateAsync!==void 0&&t.id!==void 0}function $e(t){return t.isJoi===!0}function Oe(t){return"~standard"in t}async function Pe(t,a){const s=await a["~standard"].validate(t);return s.issues?{errors:s.issues?.map(r=>({name:r.path?.map(i=>typeof i=="object"?i.key:i).join(".")||"",message:r.message}))||[],result:null}:{errors:null,result:s.value}}async function ke(t,a){try{return{errors:null,result:await a.validate(t,{abortEarly:!1})}}catch(s){if(je(s))return{errors:s.inner.map(i=>({name:i.path??"",message:i.message})),result:null};throw s}}async function De(t,a){const[s,r]=a.validate(t);return s?{errors:s.failures().map(w=>({message:w.message,name:w.path.join(".")})),result:null}:{errors:null,result:r}}async function ze(t,a){try{return{errors:null,result:await a.validateAsync(t,{abortEarly:!1})}}catch(s){if($e(s))return{errors:s.details.map(i=>({name:i.path.join("."),message:i.message})),result:null};throw s}}function Ae(t,a){if(Oe(a))return Pe(t,a);if(Be(a))return ze(t,a);if(Ie(a))return ke(t,a);if(Fe(a))return De(t,a);throw new Error("Form validation failed: Unsupported form schema")}class P extends Error{formId;errors;children;constructor(a,s,r){super("Form validation exception"),this.formId=a,this.errors=s,this.children=r,Object.setPrototypeOf(this,P.prototype)}}const Ce={base:""},Le={__name:"UForm",props:{id:{type:[String,Number],required:!1},schema:{type:null,required:!1},state:{type:Object,required:!0},validate:{type:Function,required:!1},validateOn:{type:Array,required:!1,default(){return["input","blur","change"]}},disabled:{type:Boolean,required:!1},validateOnInputDelay:{type:Number,required:!1,default:300},transform:{type:null,required:!1,default:()=>!0},attach:{type:Boolean,required:!1,default:!0},loadingAuto:{type:Boolean,required:!1,default:!0},class:{type:null,required:!1},onSubmit:{type:Function,required:!1}},emits:["submit","error"],setup(t,{expose:a,emit:s}){const r=t,i=s,w=ee(),m=g(()=>N({extend:N(Ce),...w.ui?.form||{}})),c=r.id??ae(),f=he(`form-${c}`),l=r.attach&&te(Q,void 0);b(Q,f);const k=q(new Map);G(async()=>{f.on(async e=>{e.type==="attach"?k.value.set(e.formId,{validate:e.validate}):e.type==="detach"?k.value.delete(e.formId):r.validateOn?.includes(e.type)&&!h.value&&(e.type!=="input"?await S({name:e.name,silent:!0,nested:!1}):(e.eager||L.has(e.name))&&await S({name:e.name,silent:!0,nested:!1})),e.type==="blur"&&L.add(e.name),(e.type==="change"||e.type==="input"||e.type==="blur"||e.type==="focus")&&W.add(e.name),(e.type==="change"||e.type==="input")&&z.add(e.name)})}),X(()=>{f.reset()}),G(async()=>{l&&(await ce(),l.emit({type:"attach",validate:S,formId:c}))}),X(()=>{l&&l.emit({type:"detach",formId:c})});const o=q([]);b(re,o);const D=q({});b(ve,D);const z=M(new Set),W=M(new Set),L=M(new Set);function J(e){return e.map(n=>({...n,id:n?.name?D.value[n.name]?.id:void 0}))}const Y=q(null);async function R(){let e=r.validate?await r.validate(r.state)??[]:[];if(r.schema){const{errors:n,result:u}=await Ae(r.state,r.schema);n?e=e.concat(n):Y.value=u}return J(e)}async function S(e={silent:!1,nested:!0,transform:!1}){const n=e.name&&!Array.isArray(e.name)?[e.name]:e.name,u=!n&&e.nested?Array.from(k.value.values()).map(({validate:x})=>x(e).then(()=>{}).catch(E=>{if(!(E instanceof P))throw E;return E})):[];if(n){const x=o.value.filter(I=>!n.some(j=>{const F=D.value?.[j]?.pattern;return j===I.name||F&&I.name?.match(F)})),E=(await R()).filter(I=>n.some(j=>{const F=D.value?.[j]?.pattern;return j===I.name||F&&I.name?.match(F)}));o.value=x.concat(E)}else o.value=await R();const A=(await Promise.all(u)).filter(x=>x!==void 0);if(o.value.length+A.length>0){if(e.silent)return!1;throw new P(c,o.value,A)}return e.transform&&Object.assign(r.state,Y.value),r.state}const h=q(!1);b(fe,V(h));async function T(e){h.value=r.loadingAuto&&!0;const n=e;try{n.data=await S({nested:!0,transform:r.transform}),await r.onSubmit?.(n),z.clear()}catch(u){if(!(u instanceof P))throw u;const A={...n,errors:u.errors,children:u.children};i("error",A)}finally{h.value=!1}}const _=g(()=>r.disabled||h.value);return b(pe,g(()=>({disabled:_.value,validateOnInputDelay:r.validateOnInputDelay}))),a({validate:S,errors:o,setErrors(e,n){n?o.value=o.value.filter(u=>n instanceof RegExp?!(u.name&&n.test(u.name)):u.name!==n).concat(J(e)):o.value=J(e)},async submit(){await T(new Event("submit"))},getErrors(e){return e?o.value.filter(n=>e instanceof RegExp?n.name&&e.test(n.name):n.name===e):o.value},clear(e){e?o.value=o.value.filter(n=>e instanceof RegExp?!(n.name&&e.test(n.name)):n.name!==e):o.value=[]},disabled:_,loading:h,dirty:g(()=>!!z.size),dirtyFields:V(z),blurredFields:V(L),touchedFields:V(W)}),(e,n)=>(y(),U(ye(p(l)?"div":"form"),{id:p(c),class:d(m.value({class:r.class})),onSubmit:me(T,["prevent"])},{default:K(()=>[v(e.$slots,"default",{errors:o.value,loading:h.value})]),_:3},40,["id","class"]))}};export{ge as L,Le as _,Ne as a};
